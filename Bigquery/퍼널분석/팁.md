### ARRAY + STRUCT 구조
ARRAY = 여러 줄  
STRUCT = 한 줄의 컬럼 묶음  
UNNEST = ARRAY → 줄로 펼침  

```
ARRAY<STRUCT<key, value>>

=
[
  {key: A, value: ...},
  {key: B, value: ...},
  {key: C, value: ...}
]
```

  
### timestamp를 우리가 아는 시간으로 바꾸는 방법
`DATETIME(TIMESTAMP_MICROS(evnet_timestamp)`

array_agg는 안에 order by를 넣을 수 있음
```
last_firebase_screen = 해당 세션에서 마지막으로 기록된 firebase_screen


생성방법 : array_agg(firebase_screen order by event_timestamp desc limit 1)

```

이벤트 수 퍼널: 이벤트 1건 유지 → event_timestamp 포함 가능

유저/세션 퍼널: 도달 여부 중심 → event_timestamp는 MIN() 같은 대표값으로만 사용하거나 최종 집계에서 제거


문제 서술에서 **cnt의 의미(이벤트 수 vs 유저 수 vs 세션 수)**를 명확히 분리

```
base는 “바로 다음 단계에서 쓰려는 집계 단위(grain)”에 맞춰 만든다.

다음 단계가 이벤트 분석이면: timestamp 포함 ✅

다음 단계가 세션/유저 집계면: timestamp 제외(또는 min/max로 요약)
```

